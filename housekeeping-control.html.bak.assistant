<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iLuxSys · Controle de Governança</title>
  <link rel="stylesheet" href="style.css">
  <script src="auth.js"></script>
  <script>
    // Auth guard - redirect to login if not authenticated
    if(!IluxAuth.isAuthenticated()) {
      window.location.href = 'login.html';
    }
    // Module permission check
    if(!IluxAuth.hasModuleAccess('housekeeping')) {
      alert('Você não tem permissão para acessar o módulo de Governança.');
      window.location.href = 'index.html';
    }
  </script>
  <style>
    .hk-grid { display:grid; gap:1px; background:var(--line); border-radius:8px; overflow:hidden; }
    .hk-grid .grid-header { display:grid; grid-template-columns: repeat(7, 1fr); background:var(--bg-alt); padding:12px; font-weight:500; text-transform: uppercase; }
    .hk-grid .room-row { display:grid; grid-template-columns: repeat(7, 1fr); background:var(--bg); padding:12px; align-items:center; }
    .hk-grid .room-row:hover { background: var(--bg-hover); }
    .floor-nav { display:flex; align-items:center; gap:20px; }
    .floor-nav select, .floor-nav input { padding:6px 12px; border-radius:6px; border:1px solid var(--line); background:var(--bg); }
    .floor-nav select { min-width:120px; }
    .status-yes { color:#ef4444; }
    .status-sold { color:#22c55e; }
    .muted { color: var(--muted); }
  </style>
</head>
<body>
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>
  <header>
    <div class="brand">
      <img src="assets/logo_iluxsys.png">
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <select id="langSelect" onchange="changeLanguage(this.value)" style="padding:6px;border-radius:8px;border:1px solid var(--line)">
        <option value="pt">Português</option>
        <option value="en">English</option>
        <option value="es">Español</option>
      </select>
      <button class="btn ghost" onclick="window.close()">Fechar</button>
    </div>
  </header>
  <div class="container">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <h2 id="hkTitle">Room Information - HOUSEKEEPING</h2>
        <div class="floor-nav">
          <div style="margin-right:12px;display:flex;align-items:center;gap:8px">
            <label for="floorSelect" id="lbl-floor">Pavimento:</label>
            <select id="floorSelect" class="form-select" onchange="hkChangeFloor(this.value)">
              <option value="all" id="opt-all-floors">Todos os andares</option>
              <option value="3">3º Andar</option>
              <option value="2">2º Andar</option>
              <option value="1">1º Andar</option>
            </select>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <label for="roomSearch" id="lbl-room">Quarto:</label>
            <input type="text" id="roomSearch" class="form-input" placeholder="Ex: 301" style="width:80px;padding:6px;border-radius:6px;border:1px solid var(--line)">
            <button class="btn primary" id="btn-search" onclick="hkSearchRoom()">Buscar</button>
          </div>
          <div style="margin-left:auto">
            <button class="btn" id="btn-export-csv" onclick="hkExportCSV()">Exportar CSV</button>
          </div>
        </div>
      </div>
      <div class="hk-grid">
        <div class="grid-header">
          <div id="col-room">ROOM</div>
          <div id="col-occupied">OCCUPIED</div>
          <div id="col-sold">SOLD</div>
          <div id="col-dnd">DND</div>
          <div id="col-mur">MUR</div>
          <div id="col-callservice">COLLECT TRAY</div>
          <div id="col-servicetime">SERVICE TIME / LAST UPDATE</div>
        </div>
        <div id="hkRoomRows"></div>
      </div>
      <div style="display:flex;justify-content:flex-end;align-items:center;gap:8px;margin-top:12px">
        <button class="btn" id="btn-prev" onclick="hkPrevPage()">Anterior</button>
        <div id="page-info" class="muted">1 / 1</div>
        <button class="btn" id="btn-next" onclick="hkNextPage()">Próximo</button>
      </div>
    </div>
  </div>
  <script src="app.js" defer></script>
  <script src="housekeeping.js" defer></script>
  <script>
    // Intercept console logs and send them to opener window for debugging
    (function() {
        if(window.opener && window.opener.console) {
            const originalLog = console.log;
            const originalWarn = console.warn;
            const originalError = console.error;
            
            console.log = function(...args) {
                originalLog.apply(console, args);
                try {
                    window.opener.console.log('[HK-POPUP]', ...args);
                } catch(e) { /* ignore */ }
            };
            
            console.warn = function(...args) {
                originalWarn.apply(console, args);
                try {
                    window.opener.console.warn('[HK-POPUP]', ...args);
                } catch(e) { /* ignore */ }
            };
            
            console.error = function(...args) {
                originalError.apply(console, args);
                try {
                    window.opener.console.error('[HK-POPUP]', ...args);
                } catch(e) { /* ignore */ }
            };
            
            console.log('[HK] Console interceptor installed, logs will appear in opener window');
        }
    })();
  </script>
</body>
</html>
